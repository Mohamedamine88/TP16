{"ast":null,"code":"import { ApolloClient, InMemoryCache, HttpLink, ApolloLink, Observable } from \"@apollo/client\";\nconst GRAPHQL_URI = process.env.REACT_APP_GRAPHQL_URI || \"http://localhost:8082/graphql\";\nconst httpLink = new HttpLink({\n  uri: GRAPHQL_URI,\n  fetchOptions: {\n    method: \"POST\"\n  }\n});\n\n// Minimal in-memory mock used as a fallback when the network is unavailable.\nlet nextCompteId = 1000;\nlet nextTransactionId = 5000;\nconst comptes = [];\nconst transactions = [];\nfunction findCompte(id) {\n  return comptes.find(c => String(c.id) === String(id));\n}\nfunction handleOperation(operation) {\n  const name = operation.operationName;\n  const vars = operation.variables || {};\n  switch (name) {\n    case 'GetAllComptes':\n      return {\n        data: {\n          allComptes: comptes\n        }\n      };\n    case 'GetAllTransactions':\n      return {\n        data: {\n          allTransactions: transactions\n        }\n      };\n    case 'SaveCompte':\n      {\n        const input = vars.compte || {};\n        const newCompte = {\n          id: nextCompteId++,\n          solde: input.solde || 0,\n          dateCreation: new Date().toLocaleDateString(),\n          type: input.type || 'COURANT'\n        };\n        comptes.push(newCompte);\n        return {\n          data: {\n            saveCompte: newCompte\n          }\n        };\n      }\n    case 'AddTransaction':\n      {\n        const tr = vars.transactionRequest || {};\n        const compte = findCompte(tr.compteId);\n        if (!compte) throw new Error('Compte introuvable (mock)');\n        const montant = parseFloat(tr.montant) || 0;\n        const type = tr.type || 'DEPOT';\n        if (type === 'DEPOT') compte.solde = Number(compte.solde) + montant;else if (type === 'RETRAIT') compte.solde = Number(compte.solde) - montant;\n        const newTransaction = {\n          id: nextTransactionId++,\n          type,\n          montant,\n          date: new Date().toLocaleDateString(),\n          compte: {\n            id: compte.id,\n            solde: compte.solde,\n            type: compte.type\n          }\n        };\n        transactions.unshift(newTransaction);\n        return {\n          data: {\n            addTransaction: newTransaction\n          }\n        };\n      }\n    default:\n      throw new Error(`Opération GraphQL inconnue dans le fallback mock: ${name}`);\n  }\n}\nconst mockLink = new ApolloLink(operation => new Observable(observer => {\n  const id = setTimeout(() => {\n    try {\n      const result = handleOperation(operation);\n      observer.next(result);\n      observer.complete();\n    } catch (err) {\n      observer.error(err);\n    }\n  }, 50);\n  return () => clearTimeout(id);\n}));\n\n// Link that forwards to httpLink but falls back to mockLink on network failure.\nconst fallbackLink = new ApolloLink(operation => new Observable(observer => {\n  let handled = false;\n  const httpObs = httpLink.request(operation);\n  const sub = httpObs && httpObs.subscribe({\n    next: result => {\n      handled = true;\n      observer.next(result);\n    },\n    error: err => {\n      const msg = err && (err.message || err.networkError && err.networkError.message);\n      const isNetwork = msg && msg.toString().toLowerCase().includes('failed to fetch');\n      if (isNetwork) {\n        console.warn('[apollo-client] Network error, falling back to local mock:', msg);\n        const mockObs = mockLink.request(operation);\n        if (mockObs) {\n          mockObs.subscribe({\n            next: res => observer.next(res),\n            error: e => observer.error(e),\n            complete: () => observer.complete()\n          });\n          return;\n        }\n      }\n      observer.error(err);\n    },\n    complete: () => observer.complete()\n  });\n  return () => {\n    if (sub) sub.unsubscribe();\n  };\n}));\nexport const client = new ApolloClient({\n  link: fallbackLink,\n  cache: new InMemoryCache(),\n  defaultOptions: {\n    watchQuery: {\n      fetchPolicy: 'network-only'\n    },\n    query: {\n      fetchPolicy: 'network-only'\n    }\n  }\n});","map":{"version":3,"names":["ApolloClient","InMemoryCache","HttpLink","ApolloLink","Observable","GRAPHQL_URI","process","env","REACT_APP_GRAPHQL_URI","httpLink","uri","fetchOptions","method","nextCompteId","nextTransactionId","comptes","transactions","findCompte","id","find","c","String","handleOperation","operation","name","operationName","vars","variables","data","allComptes","allTransactions","input","compte","newCompte","solde","dateCreation","Date","toLocaleDateString","type","push","saveCompte","tr","transactionRequest","compteId","Error","montant","parseFloat","Number","newTransaction","date","unshift","addTransaction","mockLink","observer","setTimeout","result","next","complete","err","error","clearTimeout","fallbackLink","handled","httpObs","request","sub","subscribe","msg","message","networkError","isNetwork","toString","toLowerCase","includes","console","warn","mockObs","res","e","unsubscribe","client","link","cache","defaultOptions","watchQuery","fetchPolicy","query"],"sources":["C:/Users/user/Desktop/5IIR_Cours/Architecture des composants/TP_16_React_GraphQL_ApolloClient/src/apollo/client.js"],"sourcesContent":["import { ApolloClient, InMemoryCache, HttpLink, ApolloLink, Observable } from \"@apollo/client\";\n\nconst GRAPHQL_URI = process.env.REACT_APP_GRAPHQL_URI || \"http://localhost:8082/graphql\";\n\nconst httpLink = new HttpLink({\n  uri: GRAPHQL_URI,\n  fetchOptions: { method: \"POST\" },\n});\n\n// Minimal in-memory mock used as a fallback when the network is unavailable.\nlet nextCompteId = 1000;\nlet nextTransactionId = 5000;\nconst comptes = [];\nconst transactions = [];\n\nfunction findCompte(id) {\n  return comptes.find(c => String(c.id) === String(id));\n}\n\nfunction handleOperation(operation) {\n  const name = operation.operationName;\n  const vars = operation.variables || {};\n\n  switch (name) {\n    case 'GetAllComptes':\n      return { data: { allComptes: comptes } };\n    case 'GetAllTransactions':\n      return { data: { allTransactions: transactions } };\n    case 'SaveCompte':\n      {\n        const input = vars.compte || {};\n        const newCompte = {\n          id: nextCompteId++,\n          solde: input.solde || 0,\n          dateCreation: new Date().toLocaleDateString(),\n          type: input.type || 'COURANT',\n        };\n        comptes.push(newCompte);\n        return { data: { saveCompte: newCompte } };\n      }\n    case 'AddTransaction':\n      {\n        const tr = vars.transactionRequest || {};\n        const compte = findCompte(tr.compteId);\n        if (!compte) throw new Error('Compte introuvable (mock)');\n        const montant = parseFloat(tr.montant) || 0;\n        const type = tr.type || 'DEPOT';\n        if (type === 'DEPOT') compte.solde = Number(compte.solde) + montant;\n        else if (type === 'RETRAIT') compte.solde = Number(compte.solde) - montant;\n        const newTransaction = {\n          id: nextTransactionId++,\n          type,\n          montant,\n          date: new Date().toLocaleDateString(),\n          compte: { id: compte.id, solde: compte.solde, type: compte.type },\n        };\n        transactions.unshift(newTransaction);\n        return { data: { addTransaction: newTransaction } };\n      }\n    default:\n      throw new Error(`Opération GraphQL inconnue dans le fallback mock: ${name}`);\n  }\n}\n\nconst mockLink = new ApolloLink((operation) =>\n  new Observable((observer) => {\n    const id = setTimeout(() => {\n      try {\n        const result = handleOperation(operation);\n        observer.next(result);\n        observer.complete();\n      } catch (err) {\n        observer.error(err);\n      }\n    }, 50);\n    return () => clearTimeout(id);\n  })\n);\n\n// Link that forwards to httpLink but falls back to mockLink on network failure.\nconst fallbackLink = new ApolloLink((operation) =>\n  new Observable((observer) => {\n    let handled = false;\n\n    const httpObs = httpLink.request(operation);\n    const sub = httpObs && httpObs.subscribe({\n      next: (result) => {\n        handled = true;\n        observer.next(result);\n      },\n      error: (err) => {\n        const msg = err && (err.message || (err.networkError && err.networkError.message));\n        const isNetwork = msg && msg.toString().toLowerCase().includes('failed to fetch');\n        if (isNetwork) {\n          console.warn('[apollo-client] Network error, falling back to local mock:', msg);\n          const mockObs = mockLink.request(operation);\n          if (mockObs) {\n            mockObs.subscribe({\n              next: (res) => observer.next(res),\n              error: (e) => observer.error(e),\n              complete: () => observer.complete(),\n            });\n            return;\n          }\n        }\n        observer.error(err);\n      },\n      complete: () => observer.complete(),\n    });\n\n    return () => {\n      if (sub) sub.unsubscribe();\n    };\n  })\n);\n\nexport const client = new ApolloClient({\n  link: fallbackLink,\n  cache: new InMemoryCache(),\n  defaultOptions: {\n    watchQuery: { fetchPolicy: 'network-only' },\n    query: { fetchPolicy: 'network-only' },\n  },\n});\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}